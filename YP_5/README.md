# Второй сборный проект. Восстановление золота из руды 
##  Цель проекта:
Создать модель, которая на основании исследования исторических данных о результатах обработки сырья (характеристики сырья, настройки оборудования, качество итоговых продуктов) обеспечит предсказание эффективности золотообработки на двух стадиях (после флотации и после итоговой очистки). Показателем качества модели принять sMAPE, которую по-возможности минимизировать.

##  Задачи проекта:
- Изучить распределение признаков
- Реализовать алгоритм расчета эффективности обагощения
- Сравнить распределений размеров гранул на обучающей и тестовой выборках
- Построить модель(и) регрессии для предсказания эффективности отчистки 
- Подобрать модель(и) используя sMAPE методом кроссвалидации для снижения рисков переобучения
- Проверить модель(и) на тестовой выборке.

##  Описание данных:
Данные распределены между тремя файлами:

    - gold_recovery_train_new.csv - тренировочная выборка
    - gold_recovery_test_new.csv - тестовая выборка
    - gold_recovery_full_new.csv - полный ДФ

В данных содержаться целевые признаки, определяющие эффективность обагощения после флотации и эффективность обагощения после финальной отчистки, а также  независимые признаки:

    - концентрации металлов во входном сырье для этапа флотации (rougher input ),
    - данные о размере гранул сырья для этапа флотации (feed size),
    - данные о реагентах (Xanthate, Sulphate, Depressant)
    - данные о настройках системы:
        - feed rate (скорость подачи)
        - fluid levels (уровень жидкости)
        - air amount (объем воздуха)

В даных используются:
 - названия этапов обработки:
    - rougher — флотация
    - primary_cleaner — первичная очистка
    - secondary_cleaner — вторичная очистка
    - final — финальные характеристики

- названия типов сырья (в зависимости от стадии):
    - input — поставляется на вход этапа
    - output — появляется на выходе этапа
    - tail — хвосты (ненужные очистки после этапа обработки)

Целью исследования было снизить риски внедрения неэфективных процессов обработки золотодобывающего сырья за счет оценки(предсказания) эффективности очистки сырья блоками оборудования с заданными характеристика, которые должны быть выполнены машинной моделью. Модель должна была быть разработана на основании исследования исторических данных об обработке золотосодержащего сырья (характеристики сырья, настроек оборудования, итоговых продуктов) и предсказывать(расчитывать) эффективность золотообагощения на двух стадиях (после флотации и после итоговой очистки). Показателем качества модели требовалось принять sMAPE, которая должна быть как можно меньше.

## В процесе исследования решены следующие задачи:
1. Загружены и изучены исторические данные о параметрах технологических установок золотообработки
2. Выполнена предобработка, включая:
    - проверку и переименование названий столбцов (приведение к стилю under_score)
    - проверку корректности назначенных типов данных (изменен столбец с датой)
    - поиск полных и неявных дубликатов (не выявлено)
    - поиск и заполнение пропусков (во всех столбцах найдены и заполненены методом скользящего окна с размером в сутки(неделю) пропуски c контролем статистических характеристик изменяемых признаков)
    - выявление аномальных значений (выявлены записи с нулевыми значениями суммарных консентраций и выбросы в размерах гранул сырья, содержащие их записи исключены из ДФ)
    - удаление неинформативных столбцов, затрудняющих обучение моделей (все столбцы с префиксами calculation и столбец date)
    - поиск коррелированых столбцов (выявлено значительное кол-во неоднократно коррелированных между собой столбцов, созданы отдельные ДФ, отчищенные от корреляции)
    - объединение всех ДФ(тренировочного, тестового, полного) в единый словарь (для автоматизации)
3. Проведено исследование данных на предмет применимости для машинного обучения:
    - изучены признаки и целевые показатели, определена принадлежность признаков к одной из трех возможных стадий обработки (флотация, первичная очистка, вторичная очистка)
    - сформированы списки признаков для машинных моделей:
        - первой, расчитывающей эффективность очистки после флотации
        - второй, расчитыающей эффективность очистки после финальной очистки
4. Проведено исследование изменений концентраций металлов в сырье от стадии к стадии, построены и проанализированы распределения плотностей вероятности для каждого металла, типа сырья (входное сырье, получившийся продукт, шаг обработки), выявлены следующие закономерности:
    - концентрация золота показывает ожидаемую тенденцию к увеличению в итоговом продукте и относительно стабильную низкую величину в хвостах,
    - концентрация серебра показывает ожидаемую тенденцию к уменьшению в итоговом продукте и небольшому увеличению в хвостах,
    - концентрация свинца показывает неожиданную тенденцию к увеличению в итоговом продукте (видимо за счет уменьшения концентрации другого МУСОРА, данных по которому у нас нет) и ожидаемое увеличение в хвостах,
    - концентрация шлака показывает ожидаемую тенденцию к уменьшению в итоговом продукте и неожидаенное уменьшение в хвостах (за счет значительного увеличение в хвостах концентрации другого МУСОРА),
5. Исследованы суммарные концентрации сырья
6. Проведено сравнение распределений размеров гранул (графически, с применением критерия Манна-Уитни), для повышения качества и стабильности предсказаний, сокращения различий между размерами гранул в тестовой и тренировочной выборках внесены ограничения модели по размеру гранул(от 20 до 120 условных единиц)
7. Проведена стандартизация количественных признаков методом preprocessing.StandartScaler
8. Подтотовлен комплект функций, автоматизирующих:
    - расчет sMAPE, суммарного sMAPE
    - выявление мультиколлерированных столбцов
    - перебор гиперпараметров моделей с/без кроссвалидации
    - выбор лучшей модели для разных комбинаций гиперпараметров, где лучшей считается модель с наименьшим значением sMAPE на тренировочной выборке
9. Проведено машинное обучение с учителем на моделях регрессии (Lasso, Ridge, DecisionTreeClassifier, LogisticRegression, ElasticNet). Выполнено:
    - обучение всех моделей на исходном ДФ (с кроссвалидацией)
    - обучение всех моделей на ДФ со стандартизацией признаков (с кроссвалидацией)
    - обучение всех моделей на отчищенном от корреляции ДФ без стандартизации (с кроссвалидацией)
    - обучение всех моделей на отчищенном от корреляции ДФ и стандартизированном ДФ (с кроссвалидацией)
    - проверка двух наиболее оптимальных моделей (ElasticNet) на тестовой выборке (без кроссвалидации)
    - расчет поэтапных и суммарной метрики sMAPE
    - проверка моделей на адеватность с применением моделей DummyClassifier
10. По результатам обучения и сравнения моделей можно отметить следующее.
    - применение кроссвалидации позволило эффективно решить проблему переобучения
    - исключение мультиколлинеарности не принесло ожидаемого эффекта (почти все модели после исключения столбцов продеманстрировали худшие результаты)
    - стандартизация также не привела к повышению качества моделей
    - метрика sMAPE не зависит от регуляризации данных
11. Достигнуты следующие итоговые показатели качества лучших моделей:
    - после флотации = 8.662766982398082
    - после финальной очистки = 8.680752761229549
    - суммарный = 8.478665205751911

## Как можно доработать проект:
    - пропробовать применить другие методы обработки пропусков (ближайшие соседи KNNImputer, алгоритм MICE IterativeImputer, c использованием линейной регрессии https://www.dmitrymakarov.ru/data-analysis/nan-06/#33-sklearn-knnimputer),
    - попробовать проанализировать графики зависмости эффективности отчистки от каждого из признаков, выделить те из них, на которых зависимость проявляется наиболее ярко и оставить только эти признаки в выборке фичерсов (или увеличить для них весовые коэффициенты),
    - попробовать применить другие методы масштабирования(регуляризации): полиноминальные (PolynomialFeatures), логарифмирование и взятие квадратного корня от признаков, трансформация Бокса-Кокса (boxcox) (https://nagornyy.me/it/regressionnye-modeli-v-python/),
    - попробовать округлить все признаки до целых значений и применить линейную модель случайного дерева
    - проиллюстрировать результативность предсказаний модели графиком Residuals plot (связь между остатками модели и предсказанными значениями),
    - наприсовать графики прогресса обагощения на этапе исследования концентраций.
